<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<div class="side_bar">
  <%= link_to @note.title, @note %><br>
  <ul>
    <% @pages.paginate(page: params[:page], per_page: APP_CONFIG["pagenate_count"]["pages"]).each do |page| %>
    <li>
      「<%= link_to page.title, url_for(controller: :pages, action: :show, note_id: @note.id, id: page.id) %>」<br>
    </li>
    <% end %>
  </ul>
  <div class="nav">
    <%= will_paginate @pages.paginate(page: params[:page], per_page: APP_CONFIG["pagenate_count"]["pages"]), :renderer => BootstrapPagination::Rails %>
  </div>
</div>
<div class="main_contents">
  <div>
    <div>
      <% if current_user %> 
        <% if @bookmarked.count > 0 && @bookmarked[0].user_id == current_user.id %>
          <%= link_to 'Remove bookmark', @bookmarked[0], method: :delete %>
        <% elsif %>
          <%= form_with(model: @bookmark, local: true) do |form| %>
            <%= form.hidden_field :user_id %>
            <%= form.hidden_field :note_id %>
            <%= form.submit %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
  <br>
  <div>
    <div class="page_row">
      <div style="float: left;width: 600px;">
          <h1>「<%= @note.title %>」</h1>
          <% if @note.user_notes[0].user.user_profile %>
          [<%= link_to @note.user_notes[0].user.username, user_profile_path(@note.user_notes[0].user.user_profile) %>] 
          <% else %>
          [<%=@note.user_notes[0].user.username %>]
          <% end %>
          <%= @note.created_at %> 
      </div>
      <br>
      <br>
      <% if current_user && @note.user_notes[0].user.id == current_user.id %>
      <%= link_to 'New Page', url_for(controller: :pages, action: :new, note_id: @note.id) %>|
      <% end %>
      <% if current_user && (current_user.has_role?(:admin) || @note.user_notes[0].user.id == current_user.id) %>
      <%= link_to 'Edit', edit_note_path(@note) %> |
      <% end %>
      <%= link_to 'Back', notes_path %> | 
      <a class="twitter-share-button"
        href="https://twitter.com/share"
        data-url="https://www.celaeno.site/notes/<%= @note.id %>/"
        data-via="susanoo"
        data-text="<%= @note.title %>"
        data-lang="ja"
        data-dnt="true">
      Tweet
      </a>
      <br>
      <br>
      <hr>
      <div style="width: 600px;font-size: 9px;">
        <%= simple_format Coderay(tag_convert(@note.overview)) %>
      </div>
      <hr>
      <div style="width: 600px;">
        <%= simple_format tag_convert(@note.detail) %>
      </div>
    </div>
  </div>
  <br>
  <% if current_user && @note.user_notes[0].user.id == current_user.id %>
  <%= link_to 'New Page', url_for(controller: :pages, action: :new, note_id: @note.id) %>|
  <% end %>
  <% if current_user && (current_user.has_role?(:admin) || @note.user_notes[0].user.id == current_user.id) %>
  <%= link_to 'Edit', edit_note_path(@note) %> |
  <% end %>
  <%= link_to 'Back', notes_path %>
</div>